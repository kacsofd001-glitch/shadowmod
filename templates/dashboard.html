<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-translate="dash_title">Server Management Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo"><a href="/" style="color: #00d4ff; text-decoration: none;">Shadow-MOD</a></div>
            <div class="nav-links">
                <div class="lang-toggle">
                    <label for="langToggle" class="lang-label">
                        <input type="checkbox" id="langToggle">
                        <span class="lang-text" data-translate="lang_en">EN</span>
                        <span class="lang-slider"></span>
                        <span class="lang-text" data-translate="lang_hu">HU</span>
                    </label>
                </div>
                <span class="user-info">
                    <img src="{{ avatar_url }}" alt="{{ username }}" class="user-avatar">
                    {{ username }}
                </span>
                <a href="/auth/logout" class="logout-btn" data-translate="logout">Logout</a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="header">
            <h1 data-translate="dash_select">Server Management</h1>
            <p data-translate="dash_select_desc">Select a server to manage</p>
        </div>

        <div class="servers-grid" id="serversGrid">
            <div class="loading" data-translate="dash_loading">Loading your servers...</div>
        </div>
    </div>

    <script>
        const translations = {
            en: {
                dash_title: "Server Management Dashboard",
                dash_select: "Server Management",
                dash_select_desc: "Select a server to manage",
                dash_loading: "Loading your servers...",
                dash_no_servers: "No servers where you are admin",
                dash_error: "Failed to load servers",
                lang_en: "EN",
                lang_hu: "HU",
                logout: "Logout"
            },
            hu: {
                dash_title: "Szerver Kezelési Irányítópult",
                dash_select: "Szerver Kezelés",
                dash_select_desc: "Válassz egy szervert a kezeléshez",
                dash_loading: "Szervereid betöltése...",
                dash_no_servers: "Nincs olyan szerver, ahol admin vagy",
                dash_error: "Szerverek betöltése sikertelen",
                lang_en: "EN",
                lang_hu: "HU",
                logout: "Kijelentkezés"
            }
        };

        let currentLang = localStorage.getItem('dashboardLang') || 'en';

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('dashboardLang', lang);
            
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            const toggle = document.getElementById('langToggle');
            if (toggle) {
                toggle.checked = (lang === 'hu');
            }
        }

        function loadServers() {
            setLanguage(currentLang);
            
            fetch('/api/servers')
                .then(response => response.json())
                .then(data => {
                    const grid = document.getElementById('serversGrid');
                    grid.innerHTML = '';
                    
                    if (!data.servers || data.servers.length === 0) {
                        grid.innerHTML = `<p class="no-servers" data-translate="dash_no_servers">No servers where you are admin</p>`;
                        setLanguage(currentLang);
                        return;
                    }
                    
                    data.servers.forEach(server => {
                        // Backend objektum kezelése (guild_id, guild_name, icon)
                        const guildId = server.guild_id;
                        const guildName = server.guild_name || "Ismeretlen szerver";
                        const iconHash = server.icon; // A backendnek ezt is küldenie kell!

                        const card = document.createElement('a');
                        card.href = `/dashboard/server/${guildId}`;
                        card.className = 'server-card';
                        
                        // Ikon logika: Ha van ikon hash, megjelenítjük a képet, egyébként a kezdőbetűt
                        let iconHtml;
                        if (iconHash && iconHash !== "None" && iconHash !== "") {
                            const iconUrl = `https://cdn.discordapp.com/icons/${guildId}/${iconHash}.png`;
                            iconHtml = `<img src="${iconUrl}" class="server-icon" alt="${guildName}" onerror="this.parentElement.innerHTML='<div class=\'server-icon-placeholder\'>${guildName.charAt(0).toUpperCase()}</div>'">`;
                        } else {
                            iconHtml = `<div class="server-icon-placeholder">${guildName.charAt(0).toUpperCase()}</div>`;
                        }
                        
                        card.innerHTML = `
                            ${iconHtml}
                            <div class="server-name">${guildName}</div>
                        `;
                        grid.appendChild(card);
                    });
                })
                .catch(error => {
                    console.error('Failed to load servers:', error);
                    const grid = document.getElementById('serversGrid');
                    grid.innerHTML = `<p class="error" data-translate="dash_error">Failed to load servers</p>`;
                    setLanguage(currentLang);
                });
        }

        document.addEventListener('DOMContentLoaded', loadServers);
        
        const toggle = document.getElementById('langToggle');
        if (toggle) {
            toggle.addEventListener('change', (e) => {
                setLanguage(e.target.checked ? 'hu' : 'en');
            });
        }
    </script>
</body>
</html>